steps:

  - task: MicroBuildSbomPlugin@1
    displayName: Install MicroBuild Sbom Plugin

  # Build the product
  - task: MSBuild@1
    displayName: 'Build product'
    inputs:
      solution: $(Build.SourcesDirectory)/Python/Product/dirs.proj
      msbuildVersion: $(MsBuildVersion)
      platform: $(Platform)
      configuration: $(BuildConfiguration)
      msbuildArguments: '/p:VSTarget=$(VSTarget) /bl:$(Build.SourcesDirectory)\logs\BuildProduct.binlog'

  # The SBOM tasks have been removed because they are generated automatically by the pipeline
  # https://eng.ms/docs/cloud-ai-platform/devdiv/one-engineering-system-1es/1es-docs/1es-pipeline-templates/features/sbom

  # Build the tests
  - task: MSBuild@1
    displayName: 'Build tests'
    inputs:
      solution: $(Build.SourcesDirectory)/Python/Tests/dirs.proj
      msbuildVersion: $(MsBuildVersion)
      platform: $(Platform)
      configuration: $(BuildConfiguration)
      msbuildArguments: '/p:VSTarget=$(VSTarget) /bl:$(Build.SourcesDirectory)\logs\BuildTests.binlog'

  # Build the installer
  - task: MSBuild@1
    displayName: 'Build installer'
    inputs:
      solution: $(Build.SourcesDirectory)/Python/Setup/dirs.proj
      msbuildVersion: $(MsBuildVersion)
      platform: $(Platform)
      configuration: $(BuildConfiguration)
      msbuildArguments: ' /p:SkipProduct=true 
                          /p:VSTarget=$(VSTarget) 
                          /p:BUILD_BINARIESDIRECTORY=$(Build.BinariesDirectory)
                          /p:BUILD_STAGINGDIRECTORY=$(Build.StagingDirectory) 
                          /bl:$(Build.SourcesDirectory)\logs\BuildInstaller.binlog'
